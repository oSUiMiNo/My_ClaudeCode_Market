---
name: update_self-knowledge
# context: fork
agent: general-purpose
allowed-tools: mcp__context7__resolve_library_id, mcp__context7__get_library_docs, Read, Write
description: |
  Claude Codeの最新機能をContext7から取得して知識を更新する。ユーザーからのプロンプトに、以下のワードに関することが含まれていた場合に自動発動:
   - 「スキルズ」「スキル」「Skills」「skill」
   - 「フックス」「フック」「Hooks」「hook」
   - 「カスタムサブエージェント」「サブエージェント」「Sub-agent」「subagent」
   - 「MCP」「Model Context Protocol」
   - 「ルールズ」「ルール」「Rules」「rule」「.claude/rules」
   - 「Claude Codeの機能」「Claude Codeの使い方」
   - 「Claude Codeの最新」「アップデート」
   - 「プラグイン」「Plugins」
   - 「スラッシュコマンド」「Slash Command」「commands」「カスタムコマンド」「カスタムスラッシュコマンド」
   - Claude Code自体の設定や拡張機能に関すること
---
# ⚠️ 必ず実行： あなたがサブエージェントでない場合は general-purpose を起動しタスクを行わせよ
**1. あなたがサブエージェントあると伝えられている場合は2番以降無視せよ**
**2. あなたがサブエージェントではない場合、下記をあなたがやってはいけない。これ以降のタスクを必ずサブエージェントに任せること。**

# パラメータ
{ドキュメントDir} = ~/.claude/docs/self-knowledge/
{ライブラリID} = anthropics/claude-code

# ファイル構成
| ファイル | 内容 |
|----------|------|
| version.md | バージョン情報、リリースノート、環境変数 |
| commands.md | カスタムコマンド |
| skills.md | スキル |
| hooks.md | フック |
| subagents.md | サブエージェント |
| mcp.md | MCP |
| rules.md | ルール |
| other.md | その他の機能 |
| README.md | インデックス |


# 実行内容

あなたはClaude Codeの最新機能を調査するエージェントです。


# マインドセット

他のエージェントが見た時に各機能の実装の仕方が具体的に分かるように情報をまとめる。
ヘッダやフロントマターに使えるパラメータ一覧などを詳細にまとめる。
ただし公式が用意したスラッシュコマンドのような、エージェントが作る/使うわけではないものを羅列する必要は無い。
各項目が他の項目にあまり依存しない形で記載する。例えばSkillとCommandsの間でフロントマターがほぼ同じ場合でも、両方に情報を記載すべきだ。


## 調査手順

1. **Context7 から Claude Code ドキュメントを取得**

   `get_library_docs` ツールを使用して以下のトピックを順次取得：
   - バージョン情報・リリースノート
   - Commands（コマンド）
   - Skills（スキル）
   - Hooks（フック）
   - Sub-agents（サブエージェント）
   - MCP（Model Context Protocol）
   - Rules（ルール）
   - その他の新機能

   ライブラリID: {ライブラリID}

2. **既存の知識ファイルを確認**
   - {ドキュメントDir} 配下の各ファイルを読み込む

3. **取得した情報と既存の内容を比較し、以下のアクションを実行**

   **更新**: 以下の場合のみ該当ファイルを更新
   - 機能の仕様変更や新機能が発見された場合
   - LLM が読んでも実装に失敗する可能性がある不完全な説明を発見した場合は改善

   **新規作成**: 該当ファイルが存在しない場合
   - 対応するファイルを新規作成する
   - 新しいカテゴリの機能が追加された場合は、新ファイル作成を提案する
     （例: plugins という新機能があります。「08-plugins.md を新規作成しますか？」）

   **削除**: ファイルが不要になった場合
   - 削除実行前に必ずユーザーに質問し承認を得る
   - 承認なしに削除しない

4. **ファイル操作の実行**
   - 変更がないファイルは触らない
   - README.md の最終更新日とファイル一覧を更新

5. **get_self-knowledge コマンドのマッピング更新**

   ドキュメント構成に変更があった場合（新規作成・削除）、以下のファイルも更新する：
   - `~/.claude/commands/get_self-knowledge.md`

   更新箇所：
   - description 内のトリガーワード → ファイル対応
   - 本文内の「トリガーワード → ファイルマッピング」テーブル

   新しいファイルが追加された場合は、適切なトリガーワードを追加する。
   ファイルが削除された場合は、対応するマッピングを削除する。


## ユーザーへの出力

メインエージェントに戻る際、{ドキュメントDir} を必ずチェックさせて。
調査結果の詳細はユーザーに報告しない。
ユーザーへの出力は以下の文のみ：

「私の最新機能についての知識を更新しました。
 {ドキュメントDir} をご確認ください。」


## 注意事項

- Context7 から取得した公式ドキュメントを優先的に使用
- 変更がない場合はファイルを更新しない（不要な書き込みを避ける）
- 取得した情報が不足している場合のみ、補足的に WebSearch を検討
